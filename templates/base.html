<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>前景识别</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-3.3.7-dist/css/bootstrap.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='jquery/jquery-3.3.1.js') }}"></script>
    <script src="{{url_for('static', filename='bootstrap-3.3.7-dist/js/bootstrap.min.js') }}"></script>
    <script src="{{url_for('static', filename='echarts/dist/echarts.min.js') }}"></script>
</head>
<body>
{% for message in get_flashed_messages() %}
    <div class="alert">
        {{ message }}
    </div>
{% endfor %}

    <div class="container" style="width: 80%">
        <div class="row" name="nav">
            <div class = "col-md-12" style="background-color:white;">
                <nav class="navbar navbar-default" style="margin-bottom:5px;margin-top:10px" role="navigation">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="#">首页</a>
                    </div>
                    <div>
                        <ul class="nav navbar-nav">
                            <li>
                                <a href="#">更多</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>

        <div class="row" name="main">
            <div class = "col-md-2" style="background-color:white;height: 300px">

                <nav class="navbar navbar-default" id="sidebar-wrapper" role="navigation">
                  <ul class="nav sidebar-nav">
                    <li class="sidebar-brand">
                    <li>
                      <a href="#"><span class="glyphicon glyphicon-upload"></span>识别图片</a>
                    </li>
                    <li><a href="#"><span class="glyphicon glyphicon-repeat"></span>历史记录 </a></li>
                  </ul>
                </nav>
            </div>
            <div class = "col-md-7" style="background-color:white;">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        识别图片
                    </div>
                    <div class="panel-body" style="height: 500px;">
                        <div name="imgButtons" style="text-align:center;">
                            <!--<form method="post" action="http://localhost:5000/upload" enctype="multipart/form-data">-->
                            <form method="post" enctype="multipart/form-data" id="img_form">
                                <label type="button" class="btn_img">
                                    <span>选择图片</span>
                                    <input type="file" name="photo" id="photo">
                                </label>
                                <!--<input type="submit" value="提交图片" class="btn_img"/>-->
                                <input type="button" value="提交图片" class="btn_img" onclick="ajaxImgForm()"/>
                            </form>
                            <script>
                                function ajaxImgForm(){
                                    var imgForm= new FormData(document.getElementById("img_form"));
                                    $.ajax({
                                        url:"{{ url_for('upload') }}",
                                        type:"post",
                                        data:imgForm,
                                        dataType: 'json',
                                        processData:false,
                                        contentType:false,
                                        success:function(data){
                                            var alertVar = $("<div id=\"successAlert\" style=\"margin-bottom: 0px\" class=\"alert alert-success alert-dismissible\" role=\"alert\">" +
                                                "<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>" +
                                                "上传成功</div>");
                                            $("#alertDiv").append(alertVar)
                                            $("#Img").attr("src",data.img_url);
                                        },
                                        error:function(e){
                                                alert(e.responseText);
                                        }
                                    })
                                }
                            </script>
                            <button type="button" class="btn_img" onclick="detectImg()">检测</button>
                            <script>
                                function detectImg(){
                                    var imgSrc = $("#Img").attr("src");
                                    $.ajax({
                                        url:"/detectImg",
                                        type:"post",
                                        data: JSON.stringify({"imgSrc":imgSrc}),
                                        dataType: 'json',
                                        processData:false,
                                        contentType:false,
                                        success:function(data){
                                            alert(data.value);
                                        },
                                        error:function(e){
                                            alert(e.responseText);
                                        }
                                    })
                                }
                            </script>
                        </div>
                        <div style="float:left;margin-left: 10px" id="alertDiv">
                        </div>
                        <div style="float:left;clear:both;">
                            {#{% block img %}#}
                            {#{% endblock %}#}
                            <img id="Img" src="" width="600" style="max-height: 400px">
                        </div>
                    </div>
                </div>
            </div>
            <div class = "col-md-3" style="background-color:white;">
                <div class="row" style="background-color: #1a4bff">
                    <div class = "col-md-12" style="background-color:white;">
                        <div class="panel panel-default">
                            <div class="panel-heading">物体</div>
                            <table class="table">
                                <th>物体记录</th><th>数量 </th>
                                <tr><td>道路</td><td>1</td></tr>
                                <tr><td>行人</td><td>2</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row" style="background-color: white">
                    <div class = "col-md-12" style="background-color:white;">
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            <h3 class="panel-title">饼图</h3>
                          </div>
                          <div class="panel-body">
                            <div id="echart1" style="width:250px;height: 250px;">
                                <script type="text/javascript">
                                    echarts.init(document.getElementById('echart1')).setOption({
                                        series: {
                                            type: 'pie',
                                            data: [
                                                {name: 'A', value: 1212},
                                                {name: 'B', value: 2323},
                                                {name: 'C', value: 1919}
                                            ]
                                        }
                                    });
                                </script>
                            </div>
                          </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="row" name="footer">
            <div class = "col-md-12 text-center" style="background-color:ghostwhite">
                <small>
                    欢迎使用
                </small>
            </div>
        </div>
    </div>
</body>
</html>
